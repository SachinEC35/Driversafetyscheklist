<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Safety Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/all.min.css">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        .card { border-radius: 15px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .status-header { background: #2c3e50; color: white; border-radius: 15px 15px 0 0; padding: 20px; }
        .btn-submit { background: #27ae60; border: none; padding: 12px; font-weight: bold; transition: 0.3s; }
        .btn-submit:hover { background: #219150; transform: translateY(-2px); }
        .form-check-input:checked { background-color: #27ae60; border-color: #27ae60; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="status-header text-center">
                    <i class="fas fa-hard-hat fa-3x mb-3"></i>
                    <h3>Vehicle Safety Checklist</h3>
                    <p id="vehicleDisplay" class="mb-0 opacity-75">Vehicle ID: Loading...</p>
                </div>
                <div class="card-body p-4">
                    <form id="checklistForm">
                        <div class="mb-4">
                            <label class="form-label fw-bold">Operator Name</label>
                            <input type="text" id="operator" class="form-control" placeholder="Enter Full Name" required>
                        </div>
                        <div class="mb-4">
    <label class="form-label fw-bold">Select Vehicle ID</label>
    <select id="vehicleSelect" class="form-select" required>
        <option value="" selected disabled>Choose Vehicle...</option>
        <option value="FL-01">Forklift 01</option>
        <option value="FL-02">Forklift 02</option>
        <option value="FL-03">Crane 01</option>
    </select>
</div>
                        

                        <h6 class="fw-bold mb-3 text-muted">Pre-Operation Inspection</h6>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="check1" required>
                            <label class="form-check-label">Brakes & Steering functional</label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="check2" required>
                            <label class="form-check-label">Tyre pressure & condition checked</label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="check3" required>
                            <label class="form-check-label">Lights & Alarms working</label>
                        </div>
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="check4" required>
                            <label class="form-check-label">No visible oil/fluid leaks</label>
                        </div>

                        <button type="submit" class="btn btn-success w-100 btn-submit">
                            <i class="fas fa-check-circle me-2"></i> AUTHORIZE IGNITION
                        </button>
                    </form>
                </div>
            </div>
            <p class="text-center mt-4 text-muted small">Systems secured by IoT Safety Protocol v2.0</p>
        </div>
    </div>
</div>

<script>
    // Get Vehicle ID from URL (?v_id=FL-01)
    const urlParams = new URLSearchParams(window.location.search);
    const vehicleId = urlParams.get('v_id') || "Unknown";
    document.getElementById('vehicleDisplay').innerText = "Vehicle ID: " + vehicleId;

    const scriptURL = 'https://script.google.com/macros/s/AKfycbxss-QB-DzoOhxArBOdGEg769WZp2x5m0FD17PA0eu8MwCmr-aNsNg6IbW01jh6bgnS/exec'; // Replace with your Deployed URL

    document.getElementById('checklistForm').addEventListener('submit', e => {
        e.preventDefault();
        
        // 1. GET THE VALUES AT THE MOMENT OF SUBMISSION
        const vehicleDropdown = document.getElementById('vehicleSelect');
        const selectedVehicle = vehicleDropdown.value;
        const operatorName = document.getElementById('operator').value;

        // 2. LOG TO CONSOLE FOR TESTING (Press F12 to see this)
        console.log("Submitting for:", selectedVehicle);

        const btn = e.target.querySelector('button');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';

        // 3. CONSTRUCT THE DATA OBJECT
        const data = {
            v_id: selectedVehicle,
            operator: operatorName,
            status: "Approved"
        };

        // 4. SEND TO GOOGLE
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', 
            cache: 'no-cache',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(() => {
            alert("Authorized! Ignition enabled for " + selectedVehicle);
            btn.innerHTML = 'AUTHORIZED';
        }).catch(error => {
            console.error('Error!', error.message);
            btn.disabled = false;
        });
    });
</script>


</body>
</html>
